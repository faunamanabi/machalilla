{
    "contents" : "\n---\ntitle: Ocupación, bajo el modelo estático (MacKenzie et al. 2002) para para las especies\n  de mamíferos en el Parque Nacional Machalilla\nauthor: Departamento Central de Investigaciones (DCI), \\break Universidad Laica Eloy\n  Alfaro de Manabi (ULEAM)\ndate: \"Abril, 2015\"\noutput:\n  pdf_document:\n    highlight: tango\n    number_sections: yes\n    toc: yes\n  html_document:\n    toc: yes\n  word_document:\n    highlight: kate\nlicense: CC\nbox: grey\n---\n\n\n\\newcommand{\\HRule}[1]{\\hfill \\rule{0.5\\linewidth}{#1}} % Horizontal rule at the bottom of the page, adjust width here\n\n%%%%%% Logo\n\\vspace{0.2in}\n\\centerline {\n  \\includegraphics[width=1in]{img/ULEAM_DCI.png}\n}\n\\vspace{0.1in}\n\n\n\n \n\\hfill Diego J. Lizcano\\\n\\hfill \\texttt{http://dlizcano.github.io/about} \\\n\\hfill \\texttt{dj.lizcano@gmail.com} \\\n\\HRule{1pt} \n\n\n# Duración del muestreo\n\nLas trampas cámara permanecieron activas desde final de septiembre 204 hasta comienzos de marzo 2015.\n \n\n```{r calendar_f,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,message=FALSE}\n\n# library(xtable)\nlibrary(lubridate)\nlibrary(dplyr)\nlibrary(maptools)\n# Load 'rgdal' package, which is used to read/write shapefiles and rasters\nlibrary(rgdal)\nsource(\"C:/Users/Diego/Documents/CodigoR/ULEAM/Infor_Caract/code/TEAM_code.R\")\nsource(\"C:/Users/Diego/Documents/CodigoR/ULEAM/Infor_Caract/code/calendar.R\")\n\nmachalilla.raw<-read.csv(\"C:/Users/Diego/Documents/CodigoR/ULEAM/Infor_Caract/Data/CT-PNM-2014.csv\") # ojo falta la camara 3-12 asume diden worked?\n\n#############################\n#### date fix\n#############################\n\n# unique(year(machalilla.raw$camera_trap_start_time))\nmachalilla.raw$photo_date2<-as.Date(as.character(machalilla.raw$photo_date), \"%d-%b-%Y\")\n\nmachalilla.raw$Sampling.Period<-2014\nmachalilla.raw$binomial<-paste(machalilla.raw$genus, machalilla.raw$specise, sep = \" \")\n\n#############################\n# translate months\n#############################\n# \n# meses<-as.data.frame(t(matrix(c(\"ago\",\"aug\",\"dic\",\"dec\",\"ene\",\"jan\",\"abr\",\"apr\"),nrow = 2,ncol = 4)))\n# machalilla.raw$camera_trap_start_time2<-NA\n# machalilla.raw$camera_trap_end_time2<-NA\n# for (i in 1:4){  \n# # get month\n#   chkmes<-substr(as.character(machalilla.raw$photo_date), start=4, stop=6)\n#   chkmes2<-substr(as.character(machalilla.raw$camera_trap_start_time), start=4, stop=6)\n#   chkmes3<-substr(as.character(machalilla.raw$camera_trap_end_time), start=4, stop=6)\n#   # chane month\n#   agoind<-which(chkmes == meses[i,1])\n#   agoind2<-which(chkmes2 == meses[i,1])\n#   agoind3<-which(chkmes3 == meses[i,1])\n#   # machalilla.raw$photo_date[agoind]\n#   machalilla.raw$photo_date2[agoind]<-as.Date(gsub(as.character(meses[i,1]), \n#                                                      as.character(meses[i,2]), \n#                                                      machalilla.raw$photo_date[agoind]), \"%d-%b-%Y\")\n#   \n#   machalilla.raw$camera_trap_start_time2[agoind2]<-as.Date(gsub(as.character(meses[i,1]), \n#                                                    as.character(meses[i,2]), \n#                                                    machalilla.raw$camera_trap_start_time[agoind2]), \"%d-%b-%Y\")\n#   \n#   machalilla.raw$camera_trap_end_time2[agoind3]<-as.Date(gsub(as.character(meses[i,1]), \n#                                                                as.character(meses[i,2]), \n#                                                                machalilla.raw$camera_trap_end_time[agoind3]), \"%d-%b-%Y\")\n# }\n# \n# # tochk\n# # unique(machalilla.raw$photo_date2)\n\n\nmachalilla.raw$camera_trap_start_date<-as.Date(substr(as.character(machalilla.raw$camera_trap_start_time), start=1, stop=11), \"%d-%b-%Y\")\nmachalilla.raw$camera_trap_end_date<-as.Date(substr(as.character(machalilla.raw$camera_trap_end_time), start=1, stop=11), \"%d-%b-%Y\")\n\n#################################\n# Fix 2011 problem\n# Two cameras have date wrong\n# CT-PNM-1-7  and  CT-PNM-3-10\n# Fix start date manually\n################################\n# identify the problem\n# index_problem_2011<-which(machalilla.raw$camera_trap_start_date == \"2011-11-11\")\n# problem_2011<-machalilla.raw[index_problem_2011,]\n# unique(problem_2011$camera_trap)\n\n\n\n# fix 1-7 just year\nindex_1_07<-which(machalilla.raw$camera_trap == \"CT-PNM-1-7\")\ncam_1_07<-machalilla.raw[index_1_07, ] # make data frame using the cam\nmachalilla.raw<-machalilla.raw[-index_1_07 ,] # remove the cam\ncam_1_07$camera_trap_start_date<-as.Date(\"2014-09-23\", format=\"%Y-%m-%d\")\ncam_1_07<-cam_1_07[-1,] # borra el primero porblematic 2011\ncam_1_07$photo_type[1]<-\"Start\" # fix start\ncam_1_07$camera_trap_end_date<-as.Date(\"2014-11-06\", format=\"%Y-%m-%d\")\n\n# fix 1-10  # add 31 days since data setup pickup en data 12 and beyond\nindex_1_10<-which(machalilla.raw$camera_trap == \"CT-PNM-1-10\")\ncam_1_10<-machalilla.raw[index_1_10, ]\nmachalilla.raw<-machalilla.raw[-index_1_10 ,]\n\ncam_1_10$camera_trap_start_date<-as.Date(\"2014-09-23\", format=\"%Y-%m-%d\") \ncam_1_10$camera_trap_end_date<-as.Date(\"2014-11-05\", format=\"%Y-%m-%d\")\ncam_1_10$photo_date2[c(12:875)]<-cam_1_10$photo_date2[c(12:875)] +31\n# delete problematic data\ncam_1_10<-cam_1_10[-24,]\ncam_1_10<-cam_1_10[-25,]\n\n# fix 3-10  # restar 30 dias\nindex_3_10<-which(machalilla.raw$camera_trap == \"CT-PNM-3-10\")\ncam_3_10<-machalilla.raw[index_3_10, ]\nmachalilla.raw<-machalilla.raw[-index_3_10 ,]\n\ncam_3_10$camera_trap_start_date<-as.Date(\"2015-01-27\", format=\"%Y-%m-%d\") \ncam_3_10$camera_trap_end_date<-as.Date(\"2015-03-15\", format=\"%Y-%m-%d\")\n# borra los primeros 30 problematicos con fecha 2011\ncam_3_10<-cam_3_10[-c(1:30),]\ncam_3_10$photo_date2<-cam_3_10$photo_date2  - 30\n\n\n# fix 3-07 # add difference of 365 days\nindex_3_07<-which(machalilla.raw$camera_trap == \"CT-PNM-3-07\")\ncam_3_07<-machalilla.raw[index_3_07, ]\n\nmachalilla.raw<-machalilla.raw[- index_3_07 ,]\ncam_3_07$camera_trap_start_date<-as.Date(\"2015-01-27\", format=\"%Y-%m-%d\")\ncam_3_07$camera_trap_end_date<-as.Date(\"2015-03-11\", format=\"%Y-%m-%d\")\ncam_3_07$photo_date2<- cam_3_07$photo_date2 + 365\n\n### remove from machalilla.raw\n# machalilla.raw<-machalilla.raw[-index_1_07 ,]\n# machalilla.raw<-machalilla.raw[-index_3_10 ,]\n# machalilla.raw<-machalilla.raw[-index_3_07 ,]\n\n#### Add corrected\nmachalilla.raw<-rbind(machalilla.raw, cam_1_07, cam_1_10, cam_3_10, cam_3_07)\n# machalilla.raw<-rbind(machalilla.raw, cam_1_10)\n# machalilla.raw<-rbind(machalilla.raw, cam_3_10)\n# machalilla.raw<-rbind(machalilla.raw, cam_3_07)\n\n#  problematic ?\n# which(machalilla.raw$photo_date2 == \"2011-11-11\")\n# which(machalilla.raw$camera_trap == \"CT-PNM-1-10\")\n\n\n########## extract yr and month\nmachalilla.raw$year<-year(machalilla.raw$photo_date2)\nmachalilla.raw$month<-month(machalilla.raw$photo_date2)\n# problem?\n# which(machalilla.raw$year == \"2011\")\n\n####################################\n# Save as R Data\n####################################\n# machalilla.fixed<-machalilla.raw\n# save(machalilla.fixed, file = \"data/machalilla_fixed.RData\")\n\n\n####################################\n# make photo calendar type\n####################################\n\n# f.calendar.yr(dataset = machalilla.raw, yr_toplot = 1)\n# f.calendar.yr(dataset = machalilla.raw, yr_toplot = 2)\n\n\n```\n\n\n```{r calendar1,cache=FALSE,warning=FALSE,eval=TRUE, echo=FALSE,fig.height=11,fig.width=8,message=FALSE}\nf.calendar.yr(dataset = machalilla.raw, yr_toplot = 1)\n```\n\n```{r calendar2,cache=FALSE,warning=FALSE,eval=TRUE, echo=FALSE,fig.height=11,fig.width=8,message=FALSE}\nf.calendar.yr(dataset = machalilla.raw, yr_toplot = 2)\n```\n\n# Especies registradas\n\nLas especies registradas en el Parque Nacional Machalilla fueron en total 36, entre aves y mamiferos\n\n\n```{r sps,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,results='asis'}\nlibrary(xtable)\nlibrary(dplyr)\nmat.per.sp<-f.matrix.creator2(data = machalilla.raw,year = 2014)\nsp.names<-names(mat.per.sp) # species names\n\n# counting how many (total) records per species by all days\ncont.per.sp<-data.frame(row.names = sp.names)\nrow.per.sp<-as.data.frame(matrix(nrow = length(sp.names), ncol=c(59)))\ncol.per.sp<-as.data.frame(matrix(nrow = length(sp.names), ncol=c(161)))\nrownames(row.per.sp)<-sp.names\nrownames(col.per.sp)<-sp.names\n\nfor (i in 1:length(mat.per.sp)){\n  cont.per.sp[i,1]<-sum(apply(as.data.frame(mat.per.sp [[i]]),FUN=sum,na.rm=T, MARGIN = 1))\n  \n   row.per.sp[i,]<-apply(mat.per.sp[[i]],1, function(x) sum(x, na.rm=T))\n   # row.per.sp[i,which(row.per.sp[i,]>0)]<-1 # convert to presence absence  1 and 0\n  \n   col.per.sp[i,]<-apply(mat.per.sp[[i]],2, function(x) sum(x, na.rm=T))\n   # col.per.sp[i,which(col.per.sp[i,]>0)]<-1 # convert to presence absence  1 and 0\n  \n}\n\n#### se full mat\nrow.per.sp\n\n# colnames(row.per.sp)<-rep\ncont.per.sp$especie<-rownames(cont.per.sp)\ncolnames(cont.per.sp)<-c(\"Numero_de_fotos\",\"especie\")\n#xtable(arrange(df = cont.per.sp, desc(Numero_de_fotos)))\nxtable(cont.per.sp)\n```\n\n## Distribucion posterior de la riqueza de especies\n\nRiqueza de especies y acumulación, modelando la ocurrencia y la detectabilidad. Este análisis sigue el método de Dorazio et al. (2006).\n\n```{r richness,cache=FALSE,warning=FALSE,eval=TRUE, echo=FALSE,fig.height=5,fig.width=8,message=FALSE}\n\nsource(\"C:/Users/Diego/Documents/CodigoR/ULEAM/Infor_Caract/code/MultiSpeciesSiteOcc.R\")\n\n# library(dplyr)\n# colapse mat in: sp by row site by column\n\nrow.per.sp<-row.per.sp[-1,] # elimina especie vacia del comienzo\n\n X1 = as.matrix(row.per.sp) # col.per.sp por dias y row.per.sp por sitios (camaras)\n nrepls = 59 \n especies = MultiSpeciesSiteOcc(nrepls, X1)\n \n # summary(especies$fit$sims.matrix)\n \n alpha.post = especies$fit$sims.matrix[,\"alpha\"]\n sigmaU.post = especies$fit$sims.matrix[,\"sigma.u\"]\n N.post = especies$fit$sims.matrix[,\"N\"]\n \n nsites = 59 \n cum_sp<-CumNumSpeciesPresent(nsites, alpha.post, sigmaU.post, N.post)\n\n#histogram of posteriors\nhist(especies$fit$sims.matrix[,\"N\"],breaks = c(33:80), xlab=\"Number of mammal species\", ylab=\"Relative frecuency\", main=\"\")\nabline(v=36,col=\"blue\", lty = 2) # -> lines.histogram(*)\n\n\n\n\n\n```\n\nLa media de la distribucion posterior es `r mean(especies$fit$sims.matrix[,\"N\"])`. Mientras que la mediana `median(especies$fit$sims.matrix[,\"N\"])`. \n\n\n# Covariables \n\nInicialmente se seleccionaron siete covariables para ajustar los modelos de ocupación. Estas cinco covariables fueron: Altitud (elev), Pendiente (slope), Distancia a la carretera pavimentada (dis rd) y distancia a la deforestación  (dist def), como covariables geográficas y altura del dosel, cobertura del dosel y área basal como covariables que se midieron momento de retirar las cámaras. Estas tres últimas covariables se midieron usando la metodología del cuadrante centrado en un punto. \n\nLa Altitud se obtuvo de una imagen SRTM del repositorio de [CGIAR](http://srtm.csi.cgiar.org/). La pendiente se infirió a partir de la altitud. La distancia a las carreteras se obtuvo de un mapa del Ministerio del Medio Ambiente del Ecuador. El mapa de deforestacion provino de los datos del [Global Forest Change](http://earthenginepartners.appspot.com/science-2013-global-forest).\n\n\n\n```{r covs,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE}\nlibrary(raster)\nlibrary(rgdal)\n# library(dismo)\n# library(biomod2)\nlibrary(spatstat)\nlibrary(sp)\nlibrary(dplyr)\nlibrary(maptools)\n\nmachalilla.raw<-read.csv(\"C:/Users/Diego/Documents/CodigoR/ULEAM/Infor_Caract/Data/CT-PNM-2014.csv\") # ojo falta la camara 3-12\n\nlong<-unique(machalilla.raw$longitude)\nlati<-unique(machalilla.raw$latitude)\ncentercoord<-c(mean(subset(long, long<=1)),mean(unique(subset(lati, lati<=1))))\ncoordsubset<-subset(machalilla.raw,select = c(camera_trap,longitude,latitude,first_name_set_camera))\n\n#################################\n# get elevation\n################################\n\n# elevation<-getData('SRTM',lon=centercoord[1], lat=centercoord[2])\n\n # read elevation from disk\nelevation<- raster(\"C://Users//Diego//Documents//CodigoR//ULEAM//Infor_Caract//code//srtm_20_13.tif\")\n\ncam.cords<-as.data.frame(distinct(coordsubset))\ncoordinates(cam.cords) <- ~longitude+latitude #make sppatial data fram\ngeo <- CRS(\"+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0\") #def cord\nproj4string(cam.cords)<-geo # set cords\n\ne<-extent (-80.9, -80.5, -1.75,-1.35)\nelevation.crop<-crop(elevation, e)\n\n# plot(elevation.crop)\n# plot(cam.cords, add=T, col=\"red\")\n# title(main=\"Altitud\", sub=\"en color rojo se muestra donde se instalaron las camaras\")\n\nslope<-terrain(elevation.crop, opt='slope', unit='degrees', neighbors=4)\n# plot(slope)\n# plot(cam.cords, add=T, col=\"red\")\n# title(main=\"Pendiente\", sub=\"en color rojo se muestra donde se instalaron las camaras\")\n\ncam.cords.sp<-SpatialPoints(cam.cords)\nproj4string(cam.cords.sp)<-geo \n# etract values\nelev.ovr <- extract(elevation.crop, cam.cords, method='bilinear')\nslope.ovr <- extract(slope, cam.cords, method='bilinear')\n\n# add to table\ncam.cords$elev<-elev.ovr\ncam.cords$slope<-slope.ovr\n\n############################\n# road\n############################\n\nroadpol <- readShapeSpatial(\"C:/Users/Diego/Documents/CodigoR/ULEAM/Infor_Caract/shp/machalilla_roadsclip.shp\")\nnames(roadpol)<-\"dist_rd\"\nproj4string(roadpol)<-geo\ndist_rd<-over(x = cam.cords, y = roadpol)\n# add to table\ncam.cords$dist_rd<-as.numeric(dist_rd[,1])\n\nroadpol.ow<-as(as(roadpol, \"SpatialPolygons\"), \"owin\") # make owin\ncam.and.covs<-as.data.frame(cam.cords)\n\n# plot(roadpol, col=topo.colors(65))\n# plot(cam.cords, add=T, col=\"red\")\n# title(main=\"Distancia a las carreteras\", sub=\"en color rojo se muestra donde se instalaron las camaras\")\n\n\n#####################################################\n## Deforestation\n####################################################\n\ndist.def<-raster(\"C:/Users/Diego/Documents/CodigoR/ULEAM/Infor_Caract/Data/dist_def.tif\")\n\n# plot(dist.def)\n# plot(cam.cords, add=T, col=\"red\")\n# title(main=\"Distancia a Deforestacion\", sub=\"en color rojo se muestra donde se instalaron las camaras\")\n\n# plot(deforestado, col=\"red\", add=T)\n# etract values\ndist.def.ovr <- extract(dist.def, cam.cords, method='bilinear')\nindex<-which(is.na(dist.def.ovr)) # detect NA. Means cam is in deforested\ndist.def.ovr [index]<-0 # camera in distance cero to deforested\n\n\n# add to table\ncam.and.covs$dist_def<-as.numeric(dist.def.ovr)\n\ncam.cords$dist_def<-dist.def.ovr\n# am.and.covs<-as.data.frame(cam.cords)\n\n\n##################################\n## Estructura Veget\n##################################\n\nest.veget<-read.csv(\"C:/Users/Diego/Documents/CodigoR/ULEAM/Infor_Caract/Data/estructVeget.csv\") # read table\n\ncam.and.covs<-cbind(cam.and.covs, est.veget) #Paste covs\n\n\n################################\ncam.and.covs.scaled <-cbind(scale(cam.and.covs[5],center = T,scale = T),\n                            scale(cam.and.covs[6],center = T,scale = T),\n                            scale(cam.and.covs[7],center = T,scale = T),\n                            scale(cam.and.covs[8],center = T,scale = T),\n                            scale(cam.and.covs[10],center = T,scale = T),\n                            scale(cam.and.covs[11],center = T,scale = T),\n                            scale(cam.and.covs[12],center = T,scale = T))\n\n  \n  \n  \n\n```\n\n\n```{r plot_covs, cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE, fig.height=9,fig.width=8}\n\npar(mfrow=c(2, 2))\nplot(elevation.crop)\nplot(cam.cords, add=T, col=\"red\")\ntitle(main=\"Altitud\")\n\nplot(slope)\nplot(cam.cords, add=T, col=\"red\")\ntitle(main=\"Pendiente\")\n\nplot(roadpol, col=topo.colors(65))\nplot(cam.cords, add=T, col=\"red\")\ntitle(main=\"Distancia a las carreteras\")\n\nplot(dist.def)\nplot(cam.cords, add=T, col=\"red\")\ntitle(main=\"Distancia a Deforestacion\")\n\n\n```\n\n\n\n```{r functions,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,results='asis'}\n\nf.sp.occu.plot.mat <- function(sp_number){\n    ########################\n    ### shrink to 15\n    ########################\n    \n    library(unmarked)\n    \n    sp15<-f.shrink.matrix.to15(matrix = mat.per.sp[[sp_number]])\n    \n    \n    ########################\n    ### make unmarked object \n    ########################\n    \n    sp_UMF <- unmarkedFrameOccu(sp15)\n    \n    plot(sp_UMF, panels=1)\n    # title(main=as.character(sp.names[sp_number]))\n     \n}\n\n\nf.sp.occu.models <- function(sp_number){\n    ########################\n    ### shrink to 15\n    ########################\n    \n    library(unmarked)\n    \n    sp15<-f.shrink.matrix.to15(matrix = mat.per.sp[[sp_number]])\n    \n    \n    ########################\n    ### make unmarked object \n    ########################\n    \n    sp_UMF <- unmarkedFrameOccu(sp15)\n    \n    # plot(sp_UMF, panels=1)\n    # title(main=as.character(sp.names[sp_number]))\n     \n    # add some  covariates\n    siteCovs(sp_UMF) <- cam.and.covs.scaled\n    \n    #######################\n    ## occu models \n    #######################\n    \n    #  covariates of detection and occupancy in that order.\n    fm0 <- occu(~ 1 ~ 1, sp_UMF) \n    fm1 <- occu(~ 1 ~ elev, sp_UMF)\n    fm2 <- occu(~ 1 ~ slope, sp_UMF)\n    fm3 <- occu(~ 1 ~ dist_rd, sp_UMF)\n    fm4 <- occu(~ elev ~ elev, sp_UMF)\n    fm5 <- occu(~ elev ~ slope, sp_UMF)\n    fm6 <- occu(~ elev ~ dist_rd, sp_UMF)\n    fm7 <- occu(~ basal_a ~ 1, sp_UMF)\n    fm8 <- occu(~ basal_a ~ elev, sp_UMF)\n    fm9 <- occu(~ basal_a ~ canopy_c, sp_UMF)\n    fm10 <- occu(~ 1 ~ canopy_c, sp_UMF)\n    fm11 <- occu(~ 1 ~ dist_def, sp_UMF)\n    fm12 <- occu(~ elev ~ dist_def, sp_UMF)\n    fm13 <- occu(~ basal_a ~ dist_def, sp_UMF)\n    fm14 <- occu(~ elev ~ canopy_c, sp_UMF)\n    \n    \n    # put the names of each model\n    models <- fitList(\n      'p(.)psi(.)' = fm0,\n      'p(.)psi(elev)' = fm1,\n      'p(.)psi(slope)' = fm2,\n      'p(.)psi(dist_rd)' = fm3,\n      'p(elev)psi(elev)' = fm4,\n      'p(elev)psi(slope)' = fm5,\n      'p(elev)psi(dist_rd)' = fm6,\n      'p(basal_a)psi(.)' = fm7,\n      'p(basal_a)psi(elev)' = fm8,\n      'p(basal_a)psi(canopy_c)' = fm9,\n      'p(.)psi(canopy_c)' = fm10,\n      'p(.)psi(dist_def)' = fm11,\n      'p(elev)psi(dist_def)' = fm12,\n      'p(basal_a)psi(dist_def)' = fm13,\n      'p(elev)psi(canopy_c)' = fm14\n      )\n    \n    ms <- modSel(models)\n    # (ms)\n    \n    #This part store some models coeficients in a table (mat_models) to compare on screen\n  ms_AIC_models<-as.data.frame(ms@ Full[1], row.names = NULL) #store model name\n  modelo<-paste(\"_\", as.character(as.character(sp.names[sp_number])), \n                \"_\", \" models\", sep=\"\") # fix model name addin species\n  ma_nPars<-as.data.frame(ms@Full$nPars) #store parameter number\n  ms_AIC_values<- as.data.frame(ms@Full$AIC) #store AIC values\n  ms_AIC_delta<- as.data.frame(ms@Full$delta) #store AIC delta values\n  ms_AIC_AICwt<- as.data.frame(ms@Full$AICwt) #store AIC wt values\n  ms_AIC_cumultw<-as.data.frame(ms@Full$cumltvWt) #store model name\n  ms_m<-as.data.frame(row.names(ms_AIC_models)) #store m number\n  ms_formula<- as.data.frame(ms@Full$formula) #store model formula\n  mat_models <- cbind(ms_AIC_models, ma_nPars, ms_AIC_values, ms_AIC_delta, ms_AIC_AICwt, ms_AIC_cumultw) #paste in matrix\n  colnames(mat_models)<-c(modelo, \"nPars\",'AIC', \"delta\", \"AICwt\", \"cumltvWt\") # change row names\n\n  ##Print los 7 primeros modelos\n  xtable(mat_models)\n  # print(spname)\n  # print (mat_models[c(1:7),])\n  # as.character(sp.names[sp_number])\n    \n    \n    \n}\n\n```\n\n#Algebra del modelo de ocupación\n\n\nCada especie tiene una historia de detección que se usó para modelar la ocupación. Esta se calculó teniendo en cuenta que cada sitio tiene también su propia historia de detección. La historia de detección puede ser representada como una ecuación matemática intuitiva, donde la especie objetivo fue detectada como una secuencia de unos y ceros de cada día de detección en cada cámara, con uno si se tomó una foto ese día y cero si no se tomó foto. Ese sitio (cámara) estará ocupado ($\\psi$), con una probabilidad que se calcula de su historia de detección de la siguiente forma para un sitio con una historia de detección 1001:\n\n$$Pr(H_{i} = 1001) =\\psi * p_{1} (1-p_{2}) (1-p_{3}) p_{4}$$\n\n\nMientras que un sitio que tuvo una historia de detección donde no se registró la especie podría ser un sitio que no está ocupado por la especie (1-$\\psi$) o estar ocupado pero la especie nunca detectada lo cual sería:\n\n$$Pr(H_{i} = 0000) =\\psi * (1-p_{1}) (1-p_{2}) (1-p_{3}) (1-p_{4}) \\textup{ or } \\psi \\prod_{1}^{4} (1-p_{j}) + (1-\\psi)$$\n\nMatemáticamente podríamos combinar todas las historias de detección en un modelo de máxima verosimilitud como: \n\n$$L(\\psi, p\\mid H_{1}...H_{x+1}) = \\prod_{1}^{x+1} \\textup{Pr} (H_{i})$$\n\nEstos modelos pueden incorporar covariables que interactúan con la ocupación y la probabilidad de ocupación y pueden ser resueltos con la ayuda del paquete unmarked del lenguaje estadístico R.\n\n#Modelos de ocupación por especie\n## La Cabra (_Capra aegagrus_)\n### Matriz de datos colapsada a 15 dias\n\n```{r mat_sp3,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,fig.height=4,fig.width=7}\n f.sp.occu.plot.mat(sp_number = 3)\n```\n\n### Seleccion de Modelos\n```{r modeo_sps3,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,results='asis'}\nprint(as.character(sp.names[sp_number=3]))\nf.sp.occu.models(sp_number = 3)\n```\n\n## El Cabeza de Mate (_Eira barbara_)\n### Matriz de datos colapsada a 15 dias\n\n```{r mat_sp6,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,fig.height=4,fig.width=7}\nf.sp.occu.plot.mat(sp_number = 6)\n```\n\n### Seleccion de Modelos\n```{r modeo_sps6,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,results='asis'}\nprint(as.character(sp.names[sp_number=6]))\nf.sp.occu.models(sp_number = 6)\n```\n\n## El tigrillo (_Leopardus wiedii_)\n### Matriz de datos colapsada a 15 dias\n\n```{r mat_sp9,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,fig.height=4,fig.width=7}\nf.sp.occu.plot.mat(sp_number = 9)\n```\n\n### Seleccion de Modelos\n```{r modeo_sps9,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,results='asis'}\nprint(as.character(sp.names[sp_number=9]))\nf.sp.occu.models(sp_number = 9)\n```\n\n\n## La vaca (_Bos primigenius_)\n### Matriz de datos colapsada a 15 dias\n\n```{r mat_sp10,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,fig.height=4,fig.width=7}\nf.sp.occu.plot.mat(sp_number = 10)\n```\n\n### Seleccion de Modelos\n```{r modeo_sps10,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,results='asis'}\nprint(as.character(sp.names[sp_number=10]))\nf.sp.occu.models(sp_number = 10)\n```\n\n## El Perro domestico (_Canis lupus_)\n### Matriz de datos colapsada a 15 dias\n\n```{r mat_sp2,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,fig.height=4,fig.width=7}\n f.sp.occu.plot.mat(sp_number = 2)\n```\n\n### Seleccion de Modelos\n```{r modeo_sps2,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,results='asis'}\nprint(as.character(sp.names[sp_number=2]))\nf.sp.occu.models(sp_number = 2)\n```\n\n## El Oso Hormiero (_Tamandua mexicana_)\n### Matriz de datos colapsada a 15 dias\n\n```{r mat_sp5,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,fig.height=4,fig.width=7}\n f.sp.occu.plot.mat(sp_number = 5)\n```\n\n### Seleccion de Modelos\n```{r modeo_sps5,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,results='asis'}\nprint(as.character(sp.names[sp_number=5]))\nf.sp.occu.models(sp_number = 5)\n```\n\n## El Venado (_Odocoileus virginianus_)\n### Matriz de datos colapsada a 15 dias\n\n```{r mat_sp8,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,fig.height=4,fig.width=7}\nf.sp.occu.plot.mat(sp_number = 8)\n```\n\n### Seleccion de Modelos\n```{r modeo_sps8,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,results='asis'}\nprint(as.character(sp.names[sp_number=8]))\nf.sp.occu.models(sp_number = 8)\n```\n\n## El Conejo (_Sylvilagus brasiliensis_)\n### Matriz de datos colapsada a 15 dias\n\n```{r mat_sp11,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,fig.height=4,fig.width=7}\n f.sp.occu.plot.mat(sp_number = 11)\n```\n\n### Seleccion de Modelos\n```{r modeo_sps11,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,results='asis'}\nprint(as.character(sp.names[sp_number=11]))\nf.sp.occu.models(sp_number = 11)\n```\n\n\n\n## El Caballo (_Equus ferus_)\n### Matriz de datos colapsada a 15 dias\n\n```{r mat_sp12,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,fig.height=4,fig.width=7}\n f.sp.occu.plot.mat(sp_number = 12)\n```\n\n### Seleccion de Modelos\n```{r modeo_sps12,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,results='asis'}\nprint(as.character(sp.names[sp_number=12]))\nf.sp.occu.models(sp_number = 12)\n```\n\n\n## La Guanta (_Cuniculus paca_)\n### Matriz de datos colapsada a 15 dias\n\n```{r mat_sp13,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,fig.height=4,fig.width=7}\n f.sp.occu.plot.mat(sp_number = 13)\n```\n\n### Seleccion de Modelos\n```{r modeo_sps13,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,results='asis'}\nprint(as.character(sp.names[sp_number=13]))\nf.sp.occu.models(sp_number = 13)\n```\n\n\n## La Guatusa (_Dasyprocta punctata_)\n### Matriz de datos colapsada a 15 dias\n\n```{r mat_sp19,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,fig.height=4,fig.width=7}\n f.sp.occu.plot.mat(sp_number = 19)\n```\n\n### Seleccion de Modelos\n```{r modeo_sps19,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,results='asis'}\nprint(as.character(sp.names[sp_number=19]))\nf.sp.occu.models(sp_number = 19)\n```\n\n## El Pecari (_Pecari tajacu_)\n### Matriz de datos colapsada a 15 dias\n\n```{r mat_sp20,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,fig.height=4,fig.width=7}\n f.sp.occu.plot.mat(sp_number = 20)\n```\n\n### Seleccion de Modelos\n```{r modeo_sps20,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,results='asis'}\nprint(as.character(sp.names[sp_number=20]))\nf.sp.occu.models(sp_number = 20)\n```\n\n## El Armadillo (_Dasypus novemcinctus_)\n### Matriz de datos colapsada a 15 dias\n\n```{r mat_sp22,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,fig.height=4,fig.width=7}\n f.sp.occu.plot.mat(sp_number = 22)\n```\n\n### Seleccion de Modelos\n```{r modeo_sps22,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,results='asis'}\nprint(as.character(sp.names[sp_number=22]))\nf.sp.occu.models(sp_number = 22)\n```\n\n\n\n## La Ardilla de Guayaquil (_Sciurus stramineus_)\n### Matriz de datos colapsada a 15 dias\n\n```{r mat_sp23,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,fig.height=4,fig.width=7}\n f.sp.occu.plot.mat(sp_number = 23)\n```\n\n### Seleccion de Modelos\n```{r modeo_sps23,cache=TRUE,warning=FALSE,eval=TRUE, echo=FALSE,results='asis'}\nprint(as.character(sp.names[sp_number=23]))\nf.sp.occu.models(sp_number = 23)\n```\n\n",
    "created" : 1437234388887.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4135921155",
    "id" : "C511EAB9",
    "lastKnownWriteTime" : 1438198761,
    "path" : "~/CodigoR/Machalilla_paper/code/Occu_Machalilla.Rmd",
    "project_path" : "code/Occu_Machalilla.Rmd",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_markdown"
}