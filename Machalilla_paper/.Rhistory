row.per.sp<-row.per.sp[-21,] # elimina Tinamus major
row.per.sp<-row.per.sp[-16,] # elimina Equus africanus
row.per.sp<-row.per.sp[-15,] # elimina Sus scrofa
row.per.sp<-row.per.sp[-14,] # elimina Rattus rattus
row.per.sp<-row.per.sp[-12,] # elimina Equus ferus
row.per.sp<-row.per.sp[-10,] # elimina Bos primigenius
row.per.sp<-row.per.sp[-07,] # elimina Buteogallus urubitinga
row.per.sp<-row.per.sp[-04,] # elimina Leptotila verreauxi
row.per.sp<-row.per.sp[-03,] # elimina Capra aegagrus
row.per.sp<-row.per.sp[-02,] # elimina Canis lupus
row.per.sp<-row.per.sp[-01,] # elimina 1a sp
# row.per.sp<-row.per.sp[-10,] # elimina Leptotila verreauxi
# row.per.sp<-row.per.sp[-08,] # elimina Tinamus major
# row.per.sp<-row.per.sp[-01,] # elimina 1era especie vacia
######### CHK names
rownames(row.per.sp)
# library(dplyr)
mat.per.sp<-f.matrix.creator2(data = machalilla.fixed,year = 2014)
sp.names<-names(mat.per.sp) # species names
# counting how many (total) records per species by all days
cont.per.sp<-data.frame(row.names = sp.names)
row.per.sp<-as.data.frame(matrix(nrow = length(sp.names), ncol=c(59)))
col.per.sp<-as.data.frame(matrix(nrow = length(sp.names), ncol=c(161)))
rownames(row.per.sp)<-sp.names
rownames(col.per.sp)<-sp.names
for (i in 1:length(mat.per.sp)){
cont.per.sp[i,1]<-sum(apply(as.data.frame(mat.per.sp [[i]]),FUN=sum,na.rm=T, MARGIN = 1))
row.per.sp[i,]<-apply(mat.per.sp[[i]],1, function(x) sum(x, na.rm=T))
# row.per.sp[i,which(row.per.sp[i,]>0)]<-1 # convert to presence absence  1 and 0
col.per.sp[i,]<-apply(mat.per.sp[[i]],2, function(x) sum(x, na.rm=T))
# col.per.sp[i,which(col.per.sp[i,]>0)]<-1 # convert to presence absence  1 and 0
}
mat.per.sp<-f.matrix.creator2(data = machalilla.fixed,year = 2014)
machalilla.fixed<-read.csv("C:/Users/Diego/Documents/CodigoR/Machalilla_paper/data/machalilla_fixed.csv")
mat.per.sp<-f.matrix.creator2(data = machalilla.fixed,year = 2014)
source("C:/Users/Diego/Documents/CodigoR/ULEAM/Infor_Caract/code/TEAM_code.R")
f.matrix.creator2
mat.per.sp<-f.matrix.creator2(data = machalilla.fixed,year = 2014)
# library(xtable)
library(lubridate)
library(dplyr)
library(maptools)
# Load 'rgdal' package, which is used to read/write shapefiles and rasters
library(rgdal)
source("C:/Users/Diego/Documents/CodigoR/ULEAM/Infor_Caract/code/TEAM_code.R")
source("C:/Users/Diego/Documents/CodigoR/ULEAM/Infor_Caract/code/calendar.R")
machalilla.raw<-read.csv("C:/Users/Diego/Documents/CodigoR/ULEAM/Infor_Caract/Data/CT-PNM-2014.csv") # ojo falta la camara 3-12
#############################
#### date fix
#############################
# unique(year(machalilla.raw$camera_trap_start_time))
machalilla.raw$photo_date2<-as.Date(as.character(machalilla.raw$photo_date), "%d-%b-%Y")
machalilla.raw$Sampling.Period<-2014
machalilla.raw$binomial<-paste(machalilla.raw$genus, machalilla.raw$specise, sep = " ")
#############################
# translate months
#############################
#
# meses<-as.data.frame(t(matrix(c("ago","aug","dic","dec","ene","jan","abr","apr"),nrow = 2,ncol = 4)))
# machalilla.raw$camera_trap_start_time2<-NA
# machalilla.raw$camera_trap_end_time2<-NA
# for (i in 1:4){
# # get month
#   chkmes<-substr(as.character(machalilla.raw$photo_date), start=4, stop=6)
#   chkmes2<-substr(as.character(machalilla.raw$camera_trap_start_time), start=4, stop=6)
#   chkmes3<-substr(as.character(machalilla.raw$camera_trap_end_time), start=4, stop=6)
#   # chane month
#   agoind<-which(chkmes == meses[i,1])
#   agoind2<-which(chkmes2 == meses[i,1])
#   agoind3<-which(chkmes3 == meses[i,1])
#   # machalilla.raw$photo_date[agoind]
#   machalilla.raw$photo_date2[agoind]<-as.Date(gsub(as.character(meses[i,1]),
#                                                      as.character(meses[i,2]),
#                                                      machalilla.raw$photo_date[agoind]), "%d-%b-%Y")
#
#   machalilla.raw$camera_trap_start_time2[agoind2]<-as.Date(gsub(as.character(meses[i,1]),
#                                                    as.character(meses[i,2]),
#                                                    machalilla.raw$camera_trap_start_time[agoind2]), "%d-%b-%Y")
#
#   machalilla.raw$camera_trap_end_time2[agoind3]<-as.Date(gsub(as.character(meses[i,1]),
#                                                                as.character(meses[i,2]),
#                                                                machalilla.raw$camera_trap_end_time[agoind3]), "%d-%b-%Y")
# }
#
# # tochk
# # unique(machalilla.raw$photo_date2)
machalilla.raw$camera_trap_start_date<-as.Date(substr(as.character(machalilla.raw$camera_trap_start_time), start=1, stop=11), "%d-%b-%Y")
machalilla.raw$camera_trap_end_date<-as.Date(substr(as.character(machalilla.raw$camera_trap_end_time), start=1, stop=11), "%d-%b-%Y")
#################################
# Fix 2011 problem
# Two cameras have date wrong
# CT-PNM-1-7  and  CT-PNM-3-10
# Fix start date manually
################################
# identify the problem
# index_problem_2011<-which(machalilla.raw$camera_trap_start_date == "2011-11-11")
# problem_2011<-machalilla.raw[index_problem_2011,]
# unique(problem_2011$camera_trap)
# fix 1-7 just year
index_1_07<-which(machalilla.raw$camera_trap == "CT-PNM-1-7")
cam_1_07<-machalilla.raw[index_1_07, ] # make data frame using the cam
machalilla.raw<-machalilla.raw[-index_1_07 ,] # remove the cam
cam_1_07$camera_trap_start_date<-as.Date("2014-09-23", format="%Y-%m-%d")
cam_1_07<-cam_1_07[-1,] # borra el primero porblematic 2011
cam_1_07$photo_type[1]<-"Start" # fix start
cam_1_07$camera_trap_end_date<-as.Date("2014-11-06", format="%Y-%m-%d")
# fix 1-10  # add 31 days since data setup pickup en data 12 and beyond
index_1_10<-which(machalilla.raw$camera_trap == "CT-PNM-1-10")
cam_1_10<-machalilla.raw[index_1_10, ]
machalilla.raw<-machalilla.raw[-index_1_10 ,]
cam_1_10$camera_trap_start_date<-as.Date("2014-09-23", format="%Y-%m-%d")
cam_1_10$camera_trap_end_date<-as.Date("2014-11-05", format="%Y-%m-%d")
cam_1_10$photo_date2[c(12:875)]<-cam_1_10$photo_date2[c(12:875)] +31
# delete problematic data
cam_1_10<-cam_1_10[-24,]
cam_1_10<-cam_1_10[-25,]
# fix 3-10  # restar 30 dias
index_3_10<-which(machalilla.raw$camera_trap == "CT-PNM-3-10")
cam_3_10<-machalilla.raw[index_3_10, ]
machalilla.raw<-machalilla.raw[-index_3_10 ,]
cam_3_10$camera_trap_start_date<-as.Date("2015-01-27", format="%Y-%m-%d")
cam_3_10$camera_trap_end_date<-as.Date("2015-03-15", format="%Y-%m-%d")
# borra los primeros 30 problematicos con fecha 2011
cam_3_10<-cam_3_10[-c(1:30),]
cam_3_10$photo_date2<-cam_3_10$photo_date2  - 30
# fix 3-07 # add difference of 365 days
index_3_07<-which(machalilla.raw$camera_trap == "CT-PNM-3-07")
cam_3_07<-machalilla.raw[index_3_07, ]
machalilla.raw<-machalilla.raw[- index_3_07 ,]
cam_3_07$camera_trap_start_date<-as.Date("2015-01-27", format="%Y-%m-%d")
cam_3_07$camera_trap_end_date<-as.Date("2015-03-11", format="%Y-%m-%d")
cam_3_07$photo_date2<- cam_3_07$photo_date2 + 365
### remove from machalilla.raw
# machalilla.raw<-machalilla.raw[-index_1_07 ,]
# machalilla.raw<-machalilla.raw[-index_3_10 ,]
# machalilla.raw<-machalilla.raw[-index_3_07 ,]
#### Add corrected
machalilla.raw<-rbind(machalilla.raw, cam_1_07, cam_1_10, cam_3_10, cam_3_07)
# machalilla.raw<-rbind(machalilla.raw, cam_1_10)
# machalilla.raw<-rbind(machalilla.raw, cam_3_10)
# machalilla.raw<-rbind(machalilla.raw, cam_3_07)
#  problematic ?
# which(machalilla.raw$photo_date2 == "2011-11-11")
# which(machalilla.raw$camera_trap == "CT-PNM-1-10")
########## extract yr and month
machalilla.raw$year<-year(machalilla.raw$photo_date2)
machalilla.raw$month<-month(machalilla.raw$photo_date2)
# problem?
# which(machalilla.raw$year == "2011")
mat.per.sp<-f.matrix.creator2(data = machalilla.raw,year = 2014)
View(machalilla.fixed)
View(machalilla.raw)
machalilla.fixed<-read.csv("C:/Users/Diego/Documents/CodigoR/Machalilla_paper/data/machalilla_fixed.csv")
mat.per.sp<-f.matrix.creator2(data = machalilla.fixed,year = 2014)
mat.per.sp<-f.matrix.creator2(data = machalilla.fixed,year = 2014)
mat.per.sp<-f.matrix.creator2(data = machalilla.fixed,year = 2014)
mat.per.sp
sp.names<-names(mat.per.sp) # species names
# counting how many (total) records per species by all days
cont.per.sp<-data.frame(row.names = sp.names)
row.per.sp<-as.data.frame(matrix(nrow = length(sp.names), ncol=c(59)))
col.per.sp<-as.data.frame(matrix(nrow = length(sp.names), ncol=c(161)))
rownames(row.per.sp)<-sp.names
rownames(col.per.sp)<-sp.names
for (i in 1:length(mat.per.sp)){
cont.per.sp[i,1]<-sum(apply(as.data.frame(mat.per.sp [[i]]),FUN=sum,na.rm=T, MARGIN = 1))
row.per.sp[i,]<-apply(mat.per.sp[[i]],1, function(x) sum(x, na.rm=T))
# row.per.sp[i,which(row.per.sp[i,]>0)]<-1 # convert to presence absence  1 and 0
col.per.sp[i,]<-apply(mat.per.sp[[i]],2, function(x) sum(x, na.rm=T))
# col.per.sp[i,which(col.per.sp[i,]>0)]<-1 # convert to presence absence  1 and 0
}
# colnames(row.per.sp)<-rep
# cont.per.sp$especie<-rownames(cont.per.sp)
# colnames(cont.per.sp)<-c("Numero_de_fotos","especie")
##################################################
### Just wild mammals not including domesticated
##################################################
# Chk names in sp.names Myotis myotis should be Artibeus sp
row.per.sp<-row.per.sp[-37,] # elimina Pheucticus chrysogaster
row.per.sp<-row.per.sp[-36,] # elimina Cathartes aura
row.per.sp<-row.per.sp[-35,] # elimina Gallus gallus
row.per.sp<-row.per.sp[-34,] # elimina Zenaida auriculata
row.per.sp<-row.per.sp[-33,] # elimina Momotus momota
row.per.sp<-row.per.sp[-30,] # elimina Heliomaster longirostris
row.per.sp<-row.per.sp[-29,] # elimina Pipistrellus pipistrellus
row.per.sp<-row.per.sp[-26,] # elimina Ortalis vetula
row.per.sp<-row.per.sp[-25,] # elimina Homo sapiens
row.per.sp<-row.per.sp[-21,] # elimina Tinamus major
row.per.sp<-row.per.sp[-16,] # elimina Equus africanus
row.per.sp<-row.per.sp[-15,] # elimina Sus scrofa
row.per.sp<-row.per.sp[-14,] # elimina Rattus rattus
row.per.sp<-row.per.sp[-12,] # elimina Equus ferus
row.per.sp<-row.per.sp[-10,] # elimina Bos primigenius
row.per.sp<-row.per.sp[-07,] # elimina Buteogallus urubitinga
row.per.sp<-row.per.sp[-04,] # elimina Leptotila verreauxi
row.per.sp<-row.per.sp[-03,] # elimina Capra aegagrus
row.per.sp<-row.per.sp[-02,] # elimina Canis lupus
row.per.sp<-row.per.sp[-01,] # elimina 1a sp
# row.per.sp<-row.per.sp[-10,] # elimina Leptotila verreauxi
# row.per.sp<-row.per.sp[-08,] # elimina Tinamus major
# row.per.sp<-row.per.sp[-01,] # elimina 1era especie vacia
######### CHK names
rownames(row.per.sp)
# Numero de especies observadas
length(row.per.sp[,1])
sp1 <- specaccum(row.per.sp)
library(vegan)
sac <- specaccum(t(row.per.sp))
plot(sac)
sp1 <- specaccum(row.per.sp)
sp2 <- specaccum(row.per.sp, "random")
sp2
summary(sp2)
plot(sp1, ci.type="poly", col="blue", lwd=2, ci.lty=0, ci.col="lightblue")
boxplot(sp2, col="yellow", add=TRUE, pch="+")
plot(sp2, ci.type="poly", col="blue", lwd=2, ci.lty=0, ci.col="lightblue")
boxplot(sp2, col="yellow", add=TRUE, pch="+")
sp2 <- specaccum(t(row.per.sp,  method = "rarefaction"))
sp2 <- specaccum(t(row.per.sp,  method = "rarefaction"))
sp2 <- specaccum(t(row.per.sp,  "rarefaction"))
sp2 <- specaccum(t(row.per.sp, "random"))
sp2 <- specaccum(t(row.per.sp),  method = "rarefaction")
sp2
summary(sp2)
plot(sp2, ci.type="poly", col="blue", lwd=2, ci.lty=0, ci.col="lightblue")
boxplot(sp2, col="yellow", add=TRUE, pch="+")
sp1 <- specaccum(t(row.per.sp), method = "random")
sp2 <- specaccum(t(row.per.sp),  method = "rarefaction")
sp2
summary(sp1)
plot(sp1, ci.type="poly", col="blue", lwd=2, ci.lty=0, ci.col="lightblue")
boxplot(sp1, col="yellow", add=TRUE, pch="+")
plot(sp2, ci.type="poly", col="blue", lwd=2, ci.lty=0, ci.col="lightblue")
plot(sp2,  col="blue", lwd=2, ci.lty=0, ci.col="lightblue")
plot(sp2,  col="blue", lwd=2)
plot(sp2, lwd=2, ci.lty=0, ci.col="lightblue")
plot(sp2, lwd=2)
plot(sp2)
boxplot(sp1, col="yellow", add=TRUE, pch="+")
sp3 <- specaccum(t(row.per.sp),  method = "collector")
plot(sp3)
H <- diversity(row.per.sp)
simp <- diversity(row.per.sp, "simpson")
invsimp <- diversity(row.per.sp, "inv")
r.2 <- rarefy(row.per.sp, 2)
alpha <- fisher.alpha(row.per.sp)
pairs(cbind(H, simp, invsimp, r.2, alpha), pch="+", col="blue")
S <- specnumber(row.per.sp) ## rowSums(BCI > 0) does the same...
J <- H/log(S)
S
J
simp
r.2
alpha
data(BCI)
specnumber(BCI)
View(BCI)
H
specnumber(t(row.per.sp))
H/log(S)
H <- diversity(t(row.per.sp))
simp <- diversity(t(row.per.sp), "simpson")
invsimp <- diversity(t(row.per.sp), "inv")
r.2 <- rarefy(t(row.per.sp), 2)
alpha <- fisher.alpha(t(row.per.sp))
pairs(cbind(H, simp, invsimp, r.2, alpha), pch="+", col="blue")
r.2
alpha
invsimp
simp
H
row.per.sp
BCI
H
boxplot(H)
plot(H)
plot(simp)
rarecurve(t(row.per.sp))
rarecurve(t(row.per.sp),step = 20, sample = raremax)
library(lubridate)
# library(dplyr)
library(maptools)
# Load 'rgdal' package, which is used to read/write shapefiles and rasters
library(rgdal)
source("C:/Users/Diego/Documents/CodigoR/ULEAM/Infor_Caract/code/TEAM_code.R")
# source("C:/Users/Diego/Documents/CodigoR/ULEAM/Infor_Caract/code/calendar.R")
machalilla.fixed<-read.csv("C:/Users/Diego/Documents/CodigoR/Machalilla_paper/data/machalilla_fixed.csv")
# library(dplyr)
mat.per.sp<-f.matrix.creator2(data = machalilla.fixed,year = 2014)
sp.names<-names(mat.per.sp) # species names
# counting how many (total) records per species by all days
cont.per.sp<-data.frame(row.names = sp.names)
row.per.sp<-as.data.frame(matrix(nrow = length(sp.names), ncol=c(59)))
col.per.sp<-as.data.frame(matrix(nrow = length(sp.names), ncol=c(161)))
rownames(row.per.sp)<-sp.names
rownames(col.per.sp)<-sp.names
for (i in 1:length(mat.per.sp)){
cont.per.sp[i,1]<-sum(apply(as.data.frame(mat.per.sp [[i]]),FUN=sum,na.rm=T, MARGIN = 1))
row.per.sp[i,]<-apply(mat.per.sp[[i]],1, function(x) sum(x, na.rm=T))
# row.per.sp[i,which(row.per.sp[i,]>0)]<-1 # convert to presence absence  1 and 0
col.per.sp[i,]<-apply(mat.per.sp[[i]],2, function(x) sum(x, na.rm=T))
# col.per.sp[i,which(col.per.sp[i,]>0)]<-1 # convert to presence absence  1 and 0
}
mat.per.sp<-f.matrix.creator2(data = machalilla.fixed,year = 2014)
machalilla.fixed
data<-machalilla.fixed
year<-2014
res<-list()
#get the dimensions of the matrix
#list if sanpling units
cams<-unique(data$camera_trap)
cams<-sort(cams)
rows<-length(cams)
species<-unique(data$binomial)
#start and end dates of sampling periods
data<-data[data$Sampling.Period==year,]
min<-min(data$camera_trap_start_date)
max<-max(data$camera_trap_end_date)
data<-data[data$Sampling.Period==year,]
min<-min(data$camera_trap_start_date)
str(data$camera_trap_start_date)
data$camera_trap_start_date
as.Date(as.character(machalilla.raw$camera_trap_start_date),  "%Y-%m-%d")
as.Date(as.character(machalilla.fied$camera_trap_start_date),  "%Y-%m-%d")
as.Date(as.character(machalilla.fixed$camera_trap_start_date),  "%Y-%m-%d")
machalilla.fixed<-read.csv("C:/Users/Diego/Documents/CodigoR/Machalilla_paper/data/machalilla_fixed.csv")
machalilla.fixed$camera_trap_start_date<-as.Date(as.character(machalilla.fixed$camera_trap_start_date),  "%Y-%m-%d")
machalilla.fixed$$camera_trap_end_date<-as.Date(as.character(machalilla.fixed$$camera_trap_end_date),  "%Y-%m-%d")
machalilla.fixed$$camera_trap_end_date<-as.Date(as.character(machalilla.fixed$camera_trap_end_date),  "%Y-%m-%d")
machalilla.fixed$camera_trap_end_date<-as.Date(as.character(machalilla.fixed$camera_trap_end_date),  "%Y-%m-%d")
mat.per.sp<-f.matrix.creator2(data = machalilla.fixed,year = 2014)
mat.per.sp[1]
sp.names<-names(mat.per.sp) # species names
sp.names
# counting how many (total) records per species by all days
cont.per.sp<-data.frame(row.names = sp.names)
row.per.sp<-as.data.frame(matrix(nrow = length(sp.names), ncol=c(59)))
col.per.sp<-as.data.frame(matrix(nrow = length(sp.names), ncol=c(161)))
rownames(row.per.sp)<-sp.names
rownames(col.per.sp)<-sp.names
for (i in 1:length(mat.per.sp)){
cont.per.sp[i,1]<-sum(apply(as.data.frame(mat.per.sp [[i]]),FUN=sum,na.rm=T, MARGIN = 1))
row.per.sp[i,]<-apply(mat.per.sp[[i]],1, function(x) sum(x, na.rm=T))
# row.per.sp[i,which(row.per.sp[i,]>0)]<-1 # convert to presence absence  1 and 0
col.per.sp[i,]<-apply(mat.per.sp[[i]],2, function(x) sum(x, na.rm=T))
# col.per.sp[i,which(col.per.sp[i,]>0)]<-1 # convert to presence absence  1 and 0
}
# colnames(row.per.sp)<-rep
# cont.per.sp$especie<-rownames(cont.per.sp)
# colnames(cont.per.sp)<-c("Numero_de_fotos","especie")
##################################################
### Just wild mammals not including domesticated
##################################################
# Chk names in sp.names Myotis myotis should be Artibeus sp
row.per.sp<-row.per.sp[-37,] # elimina Pheucticus chrysogaster
row.per.sp<-row.per.sp[-36,] # elimina Cathartes aura
row.per.sp<-row.per.sp[-35,] # elimina Gallus gallus
row.per.sp<-row.per.sp[-34,] # elimina Zenaida auriculata
row.per.sp<-row.per.sp[-33,] # elimina Momotus momota
row.per.sp<-row.per.sp[-30,] # elimina Heliomaster longirostris
row.per.sp<-row.per.sp[-29,] # elimina Pipistrellus pipistrellus
row.per.sp<-row.per.sp[-26,] # elimina Ortalis vetula
row.per.sp<-row.per.sp[-25,] # elimina Homo sapiens
row.per.sp<-row.per.sp[-21,] # elimina Tinamus major
row.per.sp<-row.per.sp[-16,] # elimina Equus africanus
row.per.sp<-row.per.sp[-15,] # elimina Sus scrofa
row.per.sp<-row.per.sp[-14,] # elimina Rattus rattus
row.per.sp<-row.per.sp[-12,] # elimina Equus ferus
row.per.sp<-row.per.sp[-10,] # elimina Bos primigenius
row.per.sp<-row.per.sp[-07,] # elimina Buteogallus urubitinga
row.per.sp<-row.per.sp[-04,] # elimina Leptotila verreauxi
row.per.sp<-row.per.sp[-03,] # elimina Capra aegagrus
row.per.sp<-row.per.sp[-02,] # elimina Canis lupus
row.per.sp<-row.per.sp[-01,] # elimina 1a sp
# row.per.sp<-row.per.sp[-10,] # elimina Leptotila verreauxi
# row.per.sp<-row.per.sp[-08,] # elimina Tinamus major
# row.per.sp<-row.per.sp[-01,] # elimina 1era especie vacia
######### CHK names
rownames(row.per.sp)
length(row.per.sp[,1])
####################
#### compare to vegan
#####################
library(vegan)
sac <- specaccum(t(row.per.sp))
plot(sac)
sac <- specaccum(t(row.per.sp))
str(row.per.sp)
row.per.sp
machalilla.fixed<-read.csv("C:/Users/Diego/Documents/CodigoR/Machalilla_paper/data/machalilla_fixed.csv")
machalilla.fixed$camera_trap_start_date<-as.Date(as.character(machalilla.fixed$camera_trap_start_date),  "%Y-%m-%d")
machalilla.fixed$camera_trap_end_date<-as.Date(as.character(machalilla.fixed$camera_trap_end_date),  "%Y-%m-%d")
# library(dplyr)
mat.per.sp<-f.matrix.creator2(data = machalilla.fixed,year = 2014)
sp.names<-names(mat.per.sp) # species names
mat.per.sp
# counting how many (total) records per species by all days
cont.per.sp<-data.frame(row.names = sp.names)
row.per.sp<-as.data.frame(matrix(nrow = length(sp.names), ncol=c(59)))
col.per.sp<-as.data.frame(matrix(nrow = length(sp.names), ncol=c(161)))
rownames(row.per.sp)<-sp.names
rownames(col.per.sp)<-sp.names
for (i in 1:length(mat.per.sp)){
cont.per.sp[i,1]<-sum(apply(as.data.frame(mat.per.sp [[i]]),FUN=sum,na.rm=T, MARGIN = 1))
row.per.sp[i,]<-apply(mat.per.sp[[i]],1, function(x) sum(x, na.rm=T))
# row.per.sp[i,which(row.per.sp[i,]>0)]<-1 # convert to presence absence  1 and 0
col.per.sp[i,]<-apply(mat.per.sp[[i]],2, function(x) sum(x, na.rm=T))
# col.per.sp[i,which(col.per.sp[i,]>0)]<-1 # convert to presence absence  1 and 0
}
# c
row.per.sp
cams<-unique(data$camera_trap)
cams<-sort(cams)
rows<-length(cams)
species<-unique(data$binomial)
#start and end dates of sampling periods
data<-data[data$Sampling.Period==year,]
min<-min(data$camera_trap_start_date)
max<-max(data$camera_trap_end_date)
data = machalilla.fixed,year = 2014
data = machalilla.fixed
year = 2014
cams<-unique(data$camera_trap)
cams<-sort(cams)
rows<-length(cams)
species<-unique(data$binomial)
#start and end dates of sampling periods
data<-data[data$Sampling.Period==year,]
min<-min(data$camera_trap_start_date)
max<-max(data$camera_trap_end_date)
cols<-max-min+1
#sampling period
date.header<-seq(from=min,to=max, by="days")
mat<-matrix(NA,rows,cols,dimnames=list(cams,as.character(date.header)))
#for all cameras, determine the open and close date and mark in the matrix
start.dates<-tapply(as.character(data$camera_trap_start_date),data$camera_trap,unique)
nms<-names(start.dates)
# start.dates<-ymd(start.dates)
names(start.dates)<-nms
start.dates
end.dates<-tapply(as.character(data$camera_trap_end_date),data$camera_trap,unique)
# end.dates<-ymd(end.dates)
names(end.dates)<-nms
#outline the sampling periods for each camera j
for(j in 1:length(start.dates)){
#for each camera beginning and end of sampling
low<-which(date.header==as.Date(start.dates[j], format = "%Y-%m-%d"))
hi<-which(date.header==as.Date(end.dates[j], format = "%Y-%m-%d"))
if(length(low)+length(hi)>0){
indx<-seq(from=low,to=hi)
mat[names(start.dates)[j],indx]<- 0
} else next
}
mat.template<-mat
mat
for(i in 1:length(species)){
indx<-which(data$bin==species[i])
#dates and cameras when/where the species was photographed
dates<-data$photo_date2[indx]
cameras<-data$camera_trap[indx]
dates.cameras<-data.frame(dates,cameras)
#unique combination of dates and cameras
dates.cameras<-unique(dates.cameras)
#fill in the matrix
for(j in 1:length(dates.cameras[,1])){
col<-which(date.header==dates.cameras[j,1])
row<-which(cams==dates.cameras[j,2])
mat[row,col]<-1
}
mat.nas<-is.na(mat)
sum.nas<-apply(mat.nas,2,sum)
indx.nas<-which(sum.nas==rows)
if(length(indx.nas)>0){
mat<-mat[,-indx.nas]
}
res<-c(res,list(mat))
#return the matrix to its original form
mat<-mat.template
}
names(res)<-species
#res<-lapply(res,f.dum)
res
}
species
View(machalilla.fixed)
library(lubridate)
# library(dplyr)
library(maptools)
# Load 'rgdal' package, which is used to read/write shapefiles and rasters
library(rgdal)
source("C:/Users/Diego/Documents/CodigoR/ULEAM/Infor_Caract/code/TEAM_code.R")
# source("C:/Users/Diego/Documents/CodigoR/ULEAM/Infor_Caract/code/calendar.R")
machalilla.fixed<-read.csv("C:/Users/Diego/Documents/CodigoR/Machalilla_paper/data/machalilla_fixed.csv")
machalilla.fixed$camera_trap_start_date<-as.Date(as.character(machalilla.fixed$camera_trap_start_date),  "%Y-%m-%d")
machalilla.fixed$camera_trap_end_date<-as.Date(as.character(machalilla.fixed$camera_trap_end_date),  "%Y-%m-%d")
# library(dplyr)
mat.per.sp<-f.matrix.creator2(data = machalilla.fixed,year = 2014)
sp.names<-names(mat.per.sp) # species names
# counting how many (total) records per species by all days
cont.per.sp<-data.frame(row.names = sp.names)
row.per.sp<-as.data.frame(matrix(nrow = length(sp.names), ncol=c(59)))
col.per.sp<-as.data.frame(matrix(nrow = length(sp.names), ncol=c(161)))
rownames(row.per.sp)<-sp.names
rownames(col.per.sp)<-sp.names
for (i in 1:length(mat.per.sp)){
cont.per.sp[i,1]<-sum(apply(as.data.frame(mat.per.sp [[i]]),FUN=sum,na.rm=T, MARGIN = 1))
row.per.sp[i,]<-apply(mat.per.sp[[i]],1, function(x) sum(x, na.rm=T))
# row.per.sp[i,which(row.per.sp[i,]>0)]<-1 # convert to presence absence  1 and 0
col.per.sp[i,]<-apply(mat.per.sp[[i]],2, function(x) sum(x, na.rm=T))
# col.per.sp[i,which(col.per.sp[i,]>0)]<-1 # convert to presence absence  1 and 0
}
warnings()
